"""
Peewee models
Generated by RDT v2.0
"""
from peewee import *
from src.extensions import db
{% if auth_enabled -%}
from werkzeug.security import generate_password_hash, check_password_hash
{% endif -%}


class User(db.Model):
    """User model"""
    username = CharField(unique=True, max_length=255)
    email = CharField(unique=True, max_length=255)
    {% if auth_enabled -%}
    password_hash = CharField(max_length=255)
    {% else -%}
    password = CharField(max_length=255, null=True)
    {% endif -%}
    created_at = DateTimeField(constraints=[SQL('DEFAULT CURRENT_TIMESTAMP')])
    
    class Meta:
        table_name = 'users'
    
    {% if auth_enabled -%}
    def set_password(self, password: str):
        """Hash and set password"""
        self.password_hash = generate_password_hash(password)
    
    def check_password(self, password: str) -> bool:
        """Verify password"""
        return check_password_hash(self.password_hash, password)
    {% endif -%}
    
    def to_dict(self):
        """Convert to dictionary"""
        return {
            'id': self.id,
            'username': self.username,
            'email': self.email,
            'created_at': self.created_at.isoformat() if self.created_at else None,
        }